<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Finding The Way Home</title>
    <meta name="description" content="raycoarana - My coding adventures and other random stuff" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/contact.css" />

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    
        <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />

    <meta property="og:site_name" content="raycoarana" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="raycoarana" />
    <meta property="og:description" content="My coding adventures and other random stuff" />
    <meta property="og:url" content="/" />
    <meta property="og:image" content="/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="raycoarana" />
    <meta name="twitter:description" content="My coding adventures and other random stuff" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image:src" content="/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Finding The Way Home",
    "url": "/",
    "image": "/assets/images/cover1.jpg",
    "description": "My coding adventures and other random stuff"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="raycoarana" href="/feed.xml" />
</head>
<body class="paged archive-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home  nav-current" role="presentation"><a href="/">Home</a></li>
        <li class="nav-development " role="presentation"><a href="/tag/development">Development</a></li>
        <li class="nav-author " role="presentation"><a href="/author/raycoarana">Author</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-contact " role="presentation"><a href="/contact">Contact</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- < default -->
<!-- The tag above means - insert everything in this file into the [body] of the default.hbs template -->

<!-- The big featured header  -->
<header class="main-header "
        style="background-image: url(/assets/images/cover1.jpg) ">
    <nav class="main-nav overlay clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/main-logo.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href><span class="word">Menu</span></a>
        
    </nav>
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">raycoarana</h1>
            <h2 class="page-description">My coding adventures and other random stuff</h2>
        </div>
    </div>
    <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
</header>

<!-- The main content area on the homepage -->
<main id="content" class="content" role="main">

    <!-- The tag below includes the post loop - partials/loop.hbs -->
        <!-- Previous/next page links - only displayed on page 2+ -->
    <div class="extra-pagination inner">
        
            <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page2/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 3 of 4 </span>
     
        <a class="older-posts" href="/page4/" title="Next Page">Older Posts &raquo;</a>
     
</nav>
        
    </div>

    <!-- This is the post loop - each post will be output using this markup -->
    
    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/blog/2014/03/primeros-pasos-con-google-glass-iii/">Voice triggers. Primeros pasos con Google Glass (III)</a></h2>
        </header>
        <section class="post-excerpt">
            <p>En el anterior artículo sobre los primeros pasos con Google Glass empezamos a ver el concepto de <strong>Voice trigger</strong>, los comandos de voz que permiten lanzar nuestras aplicaciones. Vamos a hablar un poco más cerca de ellas y qué cosas podemos hacer a día de hoy con la API.</p>

<!-- more -->

<p>[sh_margin margin=”20”]</p>

<h3 id="voice-triggers-con-prompt">Voice triggers con prompt</h3>

<p>Una de las primeras cosas que podemos hacer con un Voice trigger es hacerle una pregunta al usuario. Es decir, el usuario dice <strong><em>Ok glass, google</em></strong>, entonces el sistema antes de abrir la aplicación de Google, abre una interfaz en la que muestra una pregunta y espera a que el usuario responda a ella. Luego una vez el usuario responde a la pregunta, lanza la aplicación proporcionando como parámetro el texto capturado.</p>

<p>[caption id=”attachment_258” align=”aligncenter” width=”300”]<a href="http://raycoarana.com/wp-content/uploads/2014/03/1.prompt.png"><img src="http://raycoarana.com/wp-content/uploads/2014/03/1.prompt-300x168.png" alt="Prompt de la aplicación de Google" /></a> Prompt de la aplicación de Google[/caption]</p>

<p>Para asociar un prompt a nuestro voice trigger es tan sencillo como añadir una etiqueta <strong><em>input</em></strong> con un atributo <strong><em>prompt</em></strong> dentro de la etiqueta <strong><em>trigger</em></strong> de la siguiente forma:</p>

<p>[code language=”xml”]
<?xml version="1.0" encoding="utf-8"?></p>
<trigger keyword="@string/glass_voice_trigger">
    <input prompt="@string/glass_voice_prompt" />
</trigger>
<p>[/code]</p>

<p>Así de sencillo, con esto cuando el usuario lance nuestra aplicación, el sistema mostrará esa interfaz y capturará lo dicho por el usuario. Pero, ¿cómo recibimos esa información en nuestra aplicación? Pues como no podía ser de otra forma, a través del <strong>Intent</strong>. Para obtenerlo, debemos usar la constante <strong>RecognizerIntent.EXTRA_RESULTS</strong>, con la que obtendremos una lista de String con cada una de las palabras capturadas.</p>

<p>[code language=”java”]
ArrayList<String> voiceResults = getIntent().getExtras()
        .getStringArrayList(RecognizerIntent.EXTRA_RESULTS);
[/code]</String></p>

<p>[sh_margin margin=”20”]</p>

<h3 id="creando-un-voice-trigger-con-prompt">Creando un Voice trigger con prompt</h3>

<p>Vamos a poner en práctica lo anterior, creamos una nueva actividad en nuestro proyecto (o creamos un proyecto nuevo como <a href="http://raycoarana.com/desarrollo/primeros-pasos-con-google-glass-ii/">ya vimos</a>) con su layout, donde vamos a mostrar el texto que hemos capturado del usuario.</p>

<p>Creamos un layout con nombre <strong>activity_askmesomething.xml</strong>, cuyo contenido será el siguiente.</p>

<p>[code language=”xml”]</p>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:orientation="vertical" android:layout_width="match_parent" android:layout_height="match_parent" android:gravity="center">

    <TextView android:layout_width="match_parent" android:layout_height="wrap_content" android:gravity="center" android:textSize="18sp" android:text="I ask you something and you respond" />

    <TextView android:id="@+id/captured_input" android:layout_width="match_parent" android:layout_height="wrap_content" android:gravity="center" />

</LinearLayout>
<p>[/code]</p>

<p>Ahora creamos la actividad, enlazando con este layout.</p>

<p>[code language=”java”]
public class AskMeSomethingActivity extends Activity {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_askmesomething);
} } [/code]
</code></pre>
</div>

<p>Ahora vamos a obtener una referencia al <strong>TextView</strong> donde vamos a mostrar el texto capturado, recomponemos el texto capturado con un <strong>StringBuilder</strong> y lo asignamos al <strong>TextView</strong>. Quedaría algo así:</p>

<p>[code language=”java”]
…
        ArrayList<String> voiceResults = getIntent().getExtras()
                .getStringArrayList(RecognizerIntent.EXTRA_RESULTS);</String></p>

<div class="highlighter-rouge"><pre class="highlight"><code>    StringBuilder inputBuilder = new StringBuilder();
    for(String voiceToken : voiceResults) {
        inputBuilder.append(voiceToken);
        inputBuilder.append(" ");
    }

    TextView capturedInputText = (TextView)findViewById(R.id.captured_input);
    capturedInputText.setText(inputBuilder.toString()); ... [/code]
</code></pre>
</div>

<p>Ya por último nos queda crear el Voice trigger y añadir la nueva actividad al <strong>AndroidManifest.xml</strong>. Lo primero el Voice trigger, añadimos un nuevo fichero xml que llamamos <strong><em>askmesomething_trigger.xml</em></strong> con el siguiente contenido, nada que ya no hayamos visto antes.</p>

<p>[code language=”xml”]</p>
<trigger keyword="@string/trigger_ask_me_something">
    <input prompt="@string/prompt_ask_me_something" />
</trigger>
<p>[/code]</p>

<p>Modificamos el fichero <strong><em>strings.xml</em></strong> para agregar las nuevas cadenas.</p>

<p>[code language=”xml”]</p>
<string name="trigger_ask_me_something">ask me something</string>
<string name="prompt_ask_me_something">What\'s your favourite color?</string>
<p>[/code]</p>

<p>Y por último agregamos la actividad al <strong><em>AndroidManifest.xml</em></strong>.</p>

<p>[code language=”xml”]
…
        <activity android:name=".AskMeSomethingActivity" android:label="@string/app_name">
            <intent-filter>
                <action android:name="com.google.android.glass.action.VOICE_TRIGGER"></action>
            </intent-filter></activity></p>

<div class="highlighter-rouge"><pre class="highlight"><code>        &lt;meta-data android:name="com.google.android.glass.VoiceTrigger"
            android:resource="@xml/askmesomething_trigger" /&gt;
    &lt;/activity&gt; ... [/code]
</code></pre>
</div>

<p>Y ya tenemos todo listo, ahora solo nos falta lanzar la aplicación, decir <strong><em>Ok glass, ask me something</em></strong> y veremos la siguiente pantalla:</p>

<p>[caption id=”attachment_259” align=”aligncenter” width=”300”]<a href="http://raycoarana.com/wp-content/uploads/2014/03/2.our_prompt.png"><img src="http://raycoarana.com/wp-content/uploads/2014/03/2.our_prompt-300x168.png" alt="Prompt de nuestra aplicación" /></a> Prompt de nuestra aplicación[/caption]</p>

<p>Al responder a la pregunta, se lanzará nuestra aplicación, mostrando por pantalla lo capturado:</p>

<p>[caption id=”attachment_260” align=”aligncenter” width=”300”]<a href="http://raycoarana.com/wp-content/uploads/2014/03/3.horse_is_black.png"><img src="http://raycoarana.com/wp-content/uploads/2014/03/3.horse_is_black-300x168.png" alt="Pantalla con el resultado de la captura" /></a> Pantalla con el resultado de la captura[/caption]</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="restricciones">Restricciones</h3>

<p>Una última cosa que nos queda por comentar de los Voice triggers es la posibilidad de <strong>deshabilitarlos en función del estado del sistema</strong>, es decir, si alguna de las características del dispositivo no está disponible por la razón que fuera, el sistema deshabilita aquellos comandos de voz que lo requieran. Actualmente existen tres:</p>

<ul>
  <li>
    <p>camera</p>
  </li>
  <li>
    <p>network</p>
  </li>
  <li>
    <p>microphone</p>
  </li>
</ul>

<p>Por ejemplo, si nuestra aplicación requiere de conexión a internet, podemos limitar su uso con el siguiente código, donde podemos ver que se ha añadido la etiqueta <strong>constraints</strong> con el atributo <strong>network</strong> a <strong>true</strong>.</p>

<p>[code language=”xml”]</p>
<trigger keyword="@string/trigger_ask_me_something">
    <constraints network="true" />
</trigger>
<p>[/code]</p>

<p>Y esto es todo, el código de este artículo lo tenéis en el repositorio de esta serie de artículos, bajo la carpeta <strong>2.VoiceTriggers</strong>.</p>

<p>[github repo=”raycoarana/google_glass_first_steps”]</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="continuará">Continuará…</h3>

<p>En el próximo artículo vamos a empezar a trabajar con la <strong>Card API</strong> para crear una interfaz con la que podamos navegar e interactuar. Veremos cómo utilizar las clases <em>Card</em>, <em>CardScrollView</em> y <em>CardScrollAdapter</em> para conseguir una interfaz similar a la que podemos ver en las aplicaciones Google Glass, sin ir más lejos, el propio <strong>Timeline</strong> usa esta dinámica.</p>
 <a class="read-more" href="/blog/2014/03/primeros-pasos-con-google-glass-iii/">&raquo;</a>
        </section>
        <footer class="post-meta">
            <img class="author-thumb" src="/assets/images/avatar.jpg" alt="Author image" nopin="nopin" />
            <!-- author -->
            <a href='/author/raycoarana'>Rayco Araña</a>
            <!-- [[tags prefix=" on "]] -->
             
                on 
                
                    
                       <a href='/tag/android'>Android</a>,
                       
                
                    
                       <a href='/tag/android studio'>Android studio</a>,
                       
                
                    
                       <a href='/tag/gdk'>Gdk</a>,
                       
                
                    
                       <a href='/tag/glassware'>Glassware</a>,
                       
                
                    
                       <a href='/tag/google glass'>Google glass</a>,
                       
                
                    
                       <a href='/tag/voice trigger'>Voice trigger</a>
                       
                
            
            <time class="post-date" datetime="2014-03-28">28 Mar 2014</time>
        </footer>
    </article>
    
    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/blog/2014/03/primeros-pasos-con-google-glass-ii/">Primeros pasos con Google Glass (II)</a></h2>
        </header>
        <section class="post-excerpt">
            <p>Siguiendo la serie de artículos de primeros pasos Google Glass, toca empezar a ponernos manos a la obra con nuestra primera aplicación. En el último artículo sobre Google Glass, dimos un vistazo general de sus características técnicas y de uso, que nos sirve para tener idea de que se puede y que no se puede hacer con ellas. Si bien hay que tener en cuenta que estamos ante un producto que está aún en una fase temprana de desarrollo y que muchas cosas cambiarán hasta que su salida a la venta al público general.</p>

<!-- more -->

<p>Si no lo has leído, te recomiendo que hagas un repaso rápido al artículo antes de seguir con este, ya que te aclarará aspectos básicos de Google Glass.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="configurando-el-entorno-de-desarrollo">Configurando el entorno de desarrollo</h3>

<p>El primer paso necesario para desarrollar para Google Glass será hacernos con el <strong>GDK (Glass Development Kit)</strong>, actualmente se encuentra disponible la versión <strong>Sneak Peak</strong>, que nos da indicaciones de que es en <strong>una versión muy inmadura</strong> y todo puede cambiar de una actualización a otra sin previo aviso.</p>

<p>Para instalar el GDK, nos vamos a Android Studio (actualmente versión 0.5.2), y abrimos el SDK Manager. Como comentamos en el artículo anterior, Google Glass funciona con Android 4.0.3, por lo que el GDK lo veremos bajo grupo <strong>Android 4.0.3 (API 15)</strong>, ahí encontraremos el Glass Development Kit Sneak Peek listo para instalar.</p>

<p>[caption id=”attachment_220” align=”aligncenter” width=”300”]<a href="http://raycoarana.com/wp-content/uploads/2014/02/1.InstalandoGDK.png"><img src="http://raycoarana.com/wp-content/uploads/2014/02/1.InstalandoGDK-300x214.png" alt="Instalando GDK" /></a> Instalando GDK[/caption]</p>

<p>Una vez instalado el GDK, ya podemos comenzar el desarrollo de nuestra primera aplicación. Antes os debo dar una mala noticia, a día de hoy <strong>no existe un emulador de Google Glass</strong>, así que no busquéis una imagen del sistema para Google Glass. A día de hoy la única forma de probar una aplicación Google Glass <strong>es tener una físicamente</strong> sobre la que instalar y depurar las mismas.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="creación-del-proyecto">Creación del proyecto</h3>

<p>Vamos a crear nuestra primera aplicación, para ello iniciamos el asistente de nuevo proyecto en nuestro Android Studio y lo configuramos como podéis ver en la siguiente imagen. Básicamente dado que Google Glass a día de hoy funciona solo con Android 4.0.3, pondremos este nivel de API como <strong><em>Minimum required SDK</em></strong> y <strong><em>Target SDK</em></strong>. Así tendremos la seguridad de no utilizar API que no tengamos disponible. Si en un futuro como ya se comienza a rumorear se actualiza Glass a una versión de Android más nueva, sería conveniente cambiar el <strong><em>Target SDK</em></strong> a la nueva versión.
Por último, vamos a poner en <strong><em>Compile with</em></strong> no la API 15, sino el <strong>Glass Development Kit Sneak Peak (Google Inc.) (API 15)</strong>. Os recomiendo desmarcar la opción de crear una primera actividad, a mi siempre me gusta <strong>partir de un proyecto vacío</strong> y crear, más que partir de un proyecto lleno de código demo y tener que estar haciendo limpieza.</p>

<p>[caption id=”attachment_225” align=”aligncenter” width=”300”]<a href="http://raycoarana.com/wp-content/uploads/2014/02/2.CreandoElProyecto.png"><img src="http://raycoarana.com/wp-content/uploads/2014/02/2.CreandoElProyecto-300x194.png" alt="Creando el proyecto" /></a> Creando el proyecto[/caption]</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="retocando-el-buildgradle">Retocando el build.gradle</h3>

<p>Una vez Android Studio termina de generarnos el proyecto, lo cierto es que al menos hasta la versión 0.5.2, tiene un bug por el que no genera bien el <em>app/build.gradle</em>. La opción de configuración que hemos puesto en el asistente como <strong><em>Compile with</em></strong> no la pone en el fichero de gradle. Para solucionarlo, lo abrimos y lo modificamos para que <em><strong>compileSdkVersion</strong></em> apunte al GDK quedando así:</p>

<p>[code language=”plain”]
apply plugin: ‘android’</p>

<p>android {
    compileSdkVersion “Google Inc.:Glass Development Kit Sneak Peek:15”
    buildToolsVersion “19.0.2”</p>

<div class="highlighter-rouge"><pre class="highlight"><code>defaultConfig {
    minSdkVersion 15
    targetSdkVersion 15 ... [/code]
</code></pre>
</div>

<p>[sh_margin margin=”20”]</p>

<h3 id="androidmanifest-y-estilos">AndroidManifest y estilos</h3>

<p>El siguiente paso que debemos hacer será modificar el <strong><em>AndroidManifest.xml</em></strong> para requerir el GDK. Esto es opcional, si no lo requerimos no pasa nada, pero hay que tener en cuenta que entonces nuestra aplicación <strong>se podría instalar en otros dispositivos</strong> y al no tener estos la API del GDK, <strong>fallará</strong> al no encontrarlas.</p>

<p>Necesitamos agregar el siguiente trozo de código dentro de la etiqueta <em><strong>application</strong></em>:</p>

<p>[code language=”xml”]</p>
<uses-library android:name="com.google.android.glass" android:required="true" />

<p>[/code]</p>

<p>Para terminar de configurar el proyecto antes de comenzar a escribir código de verdad, tendremos que modificar el fichero <strong><em>res/values/styles.xml</em></strong>, para cambiar el tema base que usará nuestra aplicación. Si dejamos el que pone Android Studio, <strong>nos aparecerá en nuestra aplicación Google Glass el Action Bar</strong>, cosa nada deseable. Debemos configurar el tema para que herede del tema que trae el sistema por defecto, quedando nuestro fichero <strong><em>styles.xml</em></strong> de la siguiente forma:</p>

<p>[code language=”xml”]</p>
<resources>

    <!-- Base application theme. -->
    <style name="AppTheme" parent="@android:style/Theme.DeviceDefault">
        <!-- Customize your theme here. -->
    </style>

</resources>
<p>[/code]</p>

<p>Y para hacer algo de limpieza en el proyecto, os recomiendo borrar las carpetas <em>drawable-mdpi</em>, <em>drawable-xhdpi</em>, <em>drawable-xxhdpi</em>, ya que Google Glass utiliza una resolución hdpi y en el estado actual veo poco recomendable dedicar tiempo a generar los recursos gráficos para todas esas densidades de píxel cuando en la actualidad solo se utiliza una.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="helloworld-from-glass">Helloworld from Glass!</h3>

<p>Ya tenemos nuestro proyecto listo para comenzar a desarrollar, los pasos anteriores hasta que mejore el soporte de Android Studio para el desarrollo de Glassware, serán el pan de cada día. A partir de ahora, vamos a generar una simple actividad, que muestre un mensaje en pantalla y configuraremos nuestra aplicación para que el usuario pueda lanzarla con un comando de voz.</p>

<p>Creamos una nueva clase llamada <strong><em>HelloWorldActivity</em></strong>, haciendo que extienda de <strong><em>Activity</em></strong>. Y como siempre en cualquier aplicación Android, sobrescribimos el método <em><strong>onCreate()</strong></em> y establecemos el layout para nuestra actividad.</p>

<p>[code language=”java”]
import android.app.Activity;
import android.os.Bundle;</p>

<p>public class HelloWorldActivity extends Activity {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_helloworld);
} } [/code]
</code></pre>
</div>

<p>A continuación, ya sea con el acceso directo (Alt + Enter con el cursor sobre layout) o directamente creando el layout en la carpeta <strong><em>res/layout/activity_helloworld.xml</em></strong>, generamos nuestra vista. En ella utilizaremos un simple TextView de la siguiente forma:</p>

<p>[code language=”xml”]
<?xml version="1.0" encoding="utf-8"?></p>

<TextView xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="match_parent" android:layout_height="match_parent" android:gravity="center" android:text="HelloWorld!" />

<p>[/code]</p>

<p>Ahora que ya tenemos nuestra actividad, vamos a crear el lanzador por comando de voz. Para ello tenemos que <strong>crear un Voice Trigger</strong>. Un Voice Trigger es un pequeño fichero XML en el que indicamos a Android el <strong>comando de voz</strong> que queremos que lance nuestra aplicación. Para ello, crear un fichero en <strong><em>res/xml/trigger.xml</em></strong>. En él, pondremos el siguiente código:</p>

<p>[code language=”xml”]
<?xml version="1.0" encoding="utf-8"?></p>

<trigger keyword="@string/glass_voice_trigger" />

<p>[/code]</p>

<p>Muy simple, solo estamos indicando cuál es la frase que lanza nuestra aplicación. Vamos ahora a nuestro fichero <em><strong>res/values/string.xml</strong></em> y creamos la cadena <strong><em>glass_voice_trigger</em></strong> con el valor <em>say hello</em>.</p>

<p>[code language=”xml”]</p>
<resources>

...

    <string name="glass_voice_trigger">say hello</string>

...

</resources>
<p>[/code]</p>

<p>Pero, ¿cómo relaciona Glass el comando de voz con la actividad que queremos que lance? Pues como siempre en Android, todo ello se configura como un <strong><em>intent-filter</em></strong>, con el cual indicaremos al sistema qué comando de voz queremos que dispare nuestra actividad. Nos vamos al <strong><em>AndroidManifest.xml</em></strong> y agregamos la actividad que hemos creado, añadiendo un <strong><em>intent-filter</em></strong> que capture la acción <strong><em>com.google.android.glass.action.VOICE_TRIGGER</em></strong> y añadimos como metadatos el fichero xml que creamos anteriormente, quedando así:</p>

<p>[code language=”xml”]
…
    &lt;application …&gt;</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    ...

    &lt;activity
        android:name=".HelloWorldActivity"
        android:label="@string/app_name"&gt;
        &lt;intent-filter&gt;
            &lt;action android:name="com.google.android.glass.action.VOICE_TRIGGER" /&gt;
        &lt;/intent-filter&gt;

        &lt;meta-data android:name="com.google.android.glass.VoiceTrigger"
                   android:resource="@xml/trigger" /&gt;
    &lt;/activity&gt;

&lt;/application&gt; ... [/code]
</code></pre>
</div>

<p>Y con esto ya tenemos nuestra aplicación lista para ser lanzada. Conectamos la Google Glass y lanzamos la aplicación. Una cosa que notaréis es que el entorno os dirá que no tenéis definido ninguna actividad principal. Ignoradlo y haced que se lance sin configurar ninguna actividad por defecto.</p>

<p>[caption id=”attachment_246” align=”aligncenter” width=”180”]<a href="http://raycoarana.com/wp-content/uploads/2014/02/3.LanzandoLaApp.png"><img src="http://raycoarana.com/wp-content/uploads/2014/02/3.LanzandoLaApp-180x300.png" alt="Configurar el lanzamiento de nuestra app" /></a> Configurar el lanzamiento de nuestra app[/caption]</p>

<p>Una vez instalada, solo nos queda decir “Ok glass, say hello”. En el desarrollo normal de la aplicación, nos interesará que esta se lance directamente sin tener que decir el comando de voz, simplemente tenemos que volver a acceder a la pantalla anterior y establecer la actividad que queremos que se inicie cada vez que lancemos la aplicación desde Android Studio.</p>

<p>[caption id=”attachment_247” align=”aligncenter” width=”300”]<a href="http://raycoarana.com/wp-content/uploads/2014/02/4.HelloWorld.png"><img src="http://raycoarana.com/wp-content/uploads/2014/02/4.HelloWorld-300x168.png" alt="App HelloWorld" /></a> App HelloWorld[/caption]</p>

<p>El código de este artículo lo tenéis en el siguiente repositorio, bajo la carpeta <strong>1.Helloworld</strong>. <em>Happy coding!</em></p>

<p>[github repo=”raycoarana/google_glass_first_steps”]</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="continuará">Continuará…</h3>

<p>En el próximo artículo veremos cómo jugar un poco más con los trigger, qué configuración nos permite y cómo podemos obtener datos de lo que nos diga el usuario.</p>
 <a class="read-more" href="/blog/2014/03/primeros-pasos-con-google-glass-ii/">&raquo;</a>
        </section>
        <footer class="post-meta">
            <img class="author-thumb" src="/assets/images/avatar.jpg" alt="Author image" nopin="nopin" />
            <!-- author -->
            <a href='/author/raycoarana'>Rayco Araña</a>
            <!-- [[tags prefix=" on "]] -->
             
                on 
                
                    
                       <a href='/tag/android'>Android</a>,
                       
                
                    
                       <a href='/tag/android studio'>Android studio</a>,
                       
                
                    
                       <a href='/tag/gdk'>Gdk</a>,
                       
                
                    
                       <a href='/tag/glassware'>Glassware</a>,
                       
                
                    
                       <a href='/tag/google glass'>Google glass</a>,
                       
                
                    
                       <a href='/tag/voice trigger'>Voice trigger</a>
                       
                
            
            <time class="post-date" datetime="2014-03-26">26 Mar 2014</time>
        </footer>
    </article>
    
    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/blog/2014/03/ssl-pinning-ataques-man-in-the-middle/">SSL Pinning y ataques man-in-the-middle</a></h2>
        </header>
        <section class="post-excerpt">
            <p>Un problema que cada vez más está de actualidad es la seguridad y la privacidad en las aplicaciones móviles. Existe además un problema mayor que en otros entornos dado que es más plausible el conectarse a redes externas como WiFi’s públicas. Como desde nuestras apps no podemos controlar que redes utiliza el usuario, debemos securizar las conexiones con SSL. Pero…, ¿es esto suficiente? <em>Pues va a ser que no</em>.</p>

<!-- more -->

<p>[sh_margin margin=”20”]</p>

<h3 id="qué-es-ssl-pinning">¿Qué es SSL Pinning?</h3>

<p>Cuando se hace la negociación SSL y el servidor nos envía su certificado, por defecto Android (aunque ocurre igual en otras plataformas) comprueba que este pertenece a una autoridad certificadora de confianza y que este no está revocado o caducado. El problema es que cuando estamos en una red pública, es posible que un atacante se ponga “en medio” y se haga pasar por el servidor, haciendo de puente entre este y nosotros. Si esto lo hace con un certificado válido, nuestro sistema comprueba el certificado y lo dará por válido, pudiendo este atacante hacerse con todos los datos que intercambiamos con el servidor en <strong>texto claro</strong>.
SSL Pinning de denomina al proceso de verificar además que el certificado que ha enviado el servidor sea solo el de nuestro servidor y no cualquiera válido. Así, si detectamos un certificado válido pero que no es el de nuestro servidor, podemos rechazar la conexión, ya que existe alguien en medio <em>con el oído puesto</em>.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="cómo-implementamos-ssl-pinning-en-android">¿Cómo implementamos SSL Pinning en Android?</h3>

<p>Para poder implementar SSL Pinning en Android necesitamos en primer lugar preparar el certificado del servidor con el que vamos a conectarnos e incorporarlo a un almacén de certificados de Java. Para ello haremos uso de la herramienta <strong>keytool</strong> que viene con el JDK. Para hacer esto, ejecutaremos el siguiente comando:</p>

<p>[code language=”plain”]
keytool -importcert
        -trustcacerts
        -file “MICERTIFICADO.cer”
        -alias MIALIAS
        -keystore “sslpinning.ks”
        -provider org.bouncycastle.jce.provider.BouncyCastleProvider
        -providerpath “bcprov-jdk16-145.jar”
        -storetype BKS
        -storepass AQUI_VA_TU_PASSWORD
[/code]</p>

<p>Donde tendremos que especificar el nombre del certificado a importar al almacén de certificados y la contraseña con la que crearemos esta. Como podéis ver, es necesario para hacer esto un proveedor. Podemos utilizar el famoso BouncyCastle, para poder ejecutar este comando debemos tener el fichero <a href="http://www.bouncycastle.org/download/bcprov-jdk16-145.jar"><strong>bcprov-jdk16-145.jar</strong></a> en el lugar donde estamos ejecutándolo.</p>

<p>Una vez creado nuestro almacén de certificados con nombre <strong>sslpinning.ks</strong>, nos lo llevamos a nuestro proyecto. Lo copiaremos en la carpeta <strong>res/raw</strong>.</p>

<p>Ahora que tenemos todo listo, abrimos nuestro Eclipse/AndroidStudio y comenzamos a escribir código. Lo que vamos a necesitar será proporcionar al objeto HttpClient de Apache (que viene incluida en el SDK de Android) este almacén de certificados como únicos certificados válidos para realizar conexiones SSL. Para ello, vamos a sobrescribir la clase DefaultHttpClient. Crearemos un constructor que recibirá como parámetro el contexto para poder acceder al recurso donde tenemos el almacén de certificados.</p>

<p>[code language=”java”]
import android.content.Context;
import android.content.res.Resources;
import org.apache.http.impl.client.DefaultHttpClient;</p>

<p>public class SecureHttpClient extends DefaultHttpClient {</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Resources mResources;

public SecureHttpClient(Context context) {
    mResources = context.getResources();
}
</code></pre>
</div>

<p>}
[/code]</p>

<p>Una vez tenemos la clase, vamos a añadirle un método que se encargará de construir una factoría de sockets SSL, al que le proporcionaremos el almacén de certificados que debe utilizar como certificados de confianza.</p>

<p>[code language=”java”]
import org.apache.http.conn.ssl.SSLSocketFactory;
import java.io.InputStream;
import java.security.KeyStore;</p>

<p>…</p>

<p>private SSLSocketFactory buildSSLSocketFactory() {
    try {
        KeyStore trusted = KeyStore.getInstance(“BKS”);
        InputStream in = mResources.openRawResource(R.raw.sslpinning);
        try {
            trusted.load(in, “AQUI_VA_TU_PASSWORD”.toCharArray());
        } finally {
            in.close();
        }
        SSLSocketFactory sf = new SSLSocketFactory(trusted);
        sf.setHostnameVerifier(SSLSocketFactory.STRICT_HOSTNAME_VERIFIER);
        return sf;
    } catch (Exception e) {
        throw new AssertionError(e);
    }
}</p>

<p>…</p>

<p>[/code]</p>

<p>Una vez tenemos el método anterior, vamos a sobrescribir el método <em>createClientConnectionManager()</em>. En él vamos a registrar nuestra factoría de sockets SSL cuando se solicita una conexión sobre https. De esta forma, cada vez que el cliente Http va a realizar una conexión, creará el Socket SSL basado en nuestra configuración.</p>

<p>[code language=”java”]
import org.apache.http.conn.ClientConnectionManager;
import org.apache.http.conn.scheme.Scheme;
import org.apache.http.conn.scheme.SchemeRegistry;
import org.apache.http.conn.scheme.PlainSocketFactory;
import org.apache.http.impl.conn.tsccm.ThreadSafeClientConnManager;</p>

<p>…</p>

<p>@Override
protected ClientConnectionManager createClientConnectionManager() {
    SchemeRegistry registry = new SchemeRegistry();
    registry.register(new Scheme(“http”, PlainSocketFactory.getSocketFactory(), 80));
    registry.register(new Scheme(“https”, this.buildSSLSocketFactory(), 443));
    return new ThreadSafeClientConnManager(getParams(), registry);
}</p>

<p>…</p>

<p>[/code]</p>

<p>Y listo, con esto ya tenemos un cliente Http seguro que realiza una estricta comprobación de los certificados, confiando únicamente en aquellos que hemos incluido en nuestro almacén de certificados. Ya solo nos queda hacer las peticiones de la misma forma que lo hacemos normalmente.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="y-qué-pasa-con-las-aplicaciones-híbridas">¿Y qué pasa con las aplicaciones híbridas?</h3>

<p>En el caso de las aplicaciones híbridas lo anterior no vale. Las conexiones con el servidor no las hacemos nosotros sino que las hace el WebView que muestra nuestra aplicación. Luego debemos meternos en la negociación SSL que realiza el WebView para rechazar aquellas conexiones que no se hacen con el certificado de nuestro servidor. Pero esto es algo que dejaremos para un próximo artículo.</p>

 <a class="read-more" href="/blog/2014/03/ssl-pinning-ataques-man-in-the-middle/">&raquo;</a>
        </section>
        <footer class="post-meta">
            <img class="author-thumb" src="/assets/images/avatar.jpg" alt="Author image" nopin="nopin" />
            <!-- author -->
            <a href='/author/raycoarana'>Rayco Araña</a>
            <!-- [[tags prefix=" on "]] -->
             
                on 
                
                    
                       <a href='/tag/android'>Android</a>,
                       
                
                    
                       <a href='/tag/Man in the middle'>Man in the middle</a>,
                       
                
                    
                       <a href='/tag/seguridad'>Seguridad</a>,
                       
                
                    
                       <a href='/tag/SSL'>Ssl</a>,
                       
                
                    
                       <a href='/tag/SSL Pinning'>Ssl pinning</a>
                       
                
            
            <time class="post-date" datetime="2014-03-05">05 Mar 2014</time>
        </footer>
    </article>
    
    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/blog/2014/03/cita-equipo-mas-importante-calidad-nivel-personas-equipo-que-forma-que-decida-trabajar-equipo/">En un equipo es más importante...</a></h2>
        </header>
        <section class="post-excerpt">
            <p>En un equipo es más importante la calidad y el nivel de las personas del equipo, que la forma en la que decida trabajar el equipo.</p>

<p>El Bruno (http://elbruno.com)</p>
 <a class="read-more" href="/blog/2014/03/cita-equipo-mas-importante-calidad-nivel-personas-equipo-que-forma-que-decida-trabajar-equipo/">&raquo;</a>
        </section>
        <footer class="post-meta">
            <img class="author-thumb" src="/assets/images/avatar.jpg" alt="Author image" nopin="nopin" />
            <!-- author -->
            <a href='/author/raycoarana'>Rayco Araña</a>
            <!-- [[tags prefix=" on "]] -->
            
            <time class="post-date" datetime="2014-03-03">03 Mar 2014</time>
        </footer>
    </article>
    
    <article class="post">
        <header class="post-header">
            <h2 class="post-title"><a href="/blog/2014/03/primeros-pasos-con-google-glass/">Primeros pasos con Google Glass (I)</a></h2>
        </header>
        <section class="post-excerpt">
            <p>En esta serie de artículos, del que este es el primero, vamos a aprender a crear aplicaciones para Google Glass y esas legiones de <em>Explorers</em> que hay ahí fuera. Aunque tiene un precio aún prohibitivo y su disponibilidad es muy limitada (solo para residentes en EEUU y bajo invitación), está llamado a ser el gadget del futuro y rivalizar muy de tú a tú con otros gadgets que giran entorno a los Smartphones. Dispositivos que se conectan a nuestro Smartphone y lo complementan, permitiendo realizar ciertas acciones sin tener que sacarlo de nuestro bolsillo, como las pulseras, los relojes, etc.</p>

<!-- more -->

<p>Pero antes de empezar a hablar de cómo podemos crear Glassware (que es como se denominan estas apps), vamos a echar un vistazo a las características del hardware y del software:</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="características-técnicas">Características técnicas</h3>

<ul>
  <li>
    <p>CPU OMAP 4430 SoC 1.2Ghz Dual</p>
  </li>
  <li>
    <p>1 GB RAM</p>
  </li>
  <li>
    <p>Pantalla de 640x360 pixels (hdpi)</p>
  </li>
  <li>
    <p>Sistema operativo Android 4.0.4 (API 15)</p>
  </li>
  <li>
    <p>Cámara de 5 MP con capacidad de grabación de video a 720p</p>
  </li>
  <li>
    <p>TouchPad</p>
  </li>
  <li>
    <p>GPS y SMS a tráves de conexión con smartphone</p>
  </li>
  <li>
    <p>Bluetooth</p>
  </li>
  <li>
    <p>WiFi 802.11b/g</p>
  </li>
  <li>
    <p>16 GB de almacenamiento (12 GB libres para el usuario)</p>
  </li>
  <li>
    <p>Giroscopio, acelerómetro, magnetómetro, sensor de luz ambiental y sensor de proximidad</p>
  </li>
  <li>
    <p>Micrófono y transductor de conducción ósea que actúa como altavoz</p>
  </li>
  <li>
    <p>Conector MicroUSB, tanto para conexión con el PC como para salida de auriculares</p>
  </li>
</ul>

<p>[sh_margin margin=”20”]</p>

<h3 id="cómo-se-maneja">¿Cómo se maneja?</h3>

<p>El manejo de Google Glass se realiza con una combinación entre voz, gestos con la cabeza e interacción con el TouchPad. Desde encenderlas moviendo la cabeza hacia arriba (o tocando el TouchPad) se puede interactuar con el ya famoso <strong>Ok glass…</strong> o interactuando con el TouchPad con Swipe hacia adelante/atrás, toques y Swipe abajo que hace las veces de botón atrás. Adicionalmente y a discreción de la aplicación que tengamos abierta, esta puede hacer uso de otro tipo de gestos en el TouchPad, como veremos en próximos artículos.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="google-glass-es-un-dispositivo-android-más">Google Glass es un dispositivo Android más</h3>

<p>Como hemos comentado anteriormente, las Google Glass tienen como sistema operativo un Android 4.0.4, una revisión de Android 4.0.3 en el que se mantiene su nivel de API (API 15). Por lo tanto, el modelo de programación es exactamente el mismo y la API es exactamente la misma a la de cualquier aplicación Android, salvo unas pequeñas excepciones a tener en cuenta y que iremos comentando poco a poco.</p>

<p>El entorno de desarrollo a utilizar para desarrollar Glassware será Eclipse con el plug-in ADT o Android Studio, igual que para una aplicación Android para Smartphones o Tablets. Lo que deberemos tener en cuenta a la hora de crear un proyecto para Google Glass es que la API a la que nos dirigimos es la 15.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="el-timeline-un-launcher-propio">El Timeline, un launcher propio</h3>

<p>[caption id=”attachment_173” align=”aligncenter” width=”520”]<img src="http://raycoarana.com/wp-content/uploads/2014/03/timeline.png" alt="Representación del Timeline" /> Representación del Timeline[/caption]</p>

<p>Cuando un usuario inicia o activa su Google Glass, verá en primer lugar lo que se llama el Timeline. Este Timeline no es más que un launcher propio, desde el que se lanzan las aplicaciones y en el que se pueden visualizar notificaciones y widgets, que en el caso de Google Glass reciben el nombre de tarjetas o Cards. Estas son siempre a pantalla completa. Luego el Timeline es un conjunto de estas tarjetas, colocadas de forma longitudinal y sobre las que el usuario se puede mover usando el TouchPad. Es por ello que las tarjetas tienen acceso restringido al TouchPad, para evitar entrar en conflicto con los gestos de Swipe adelante/atrás.</p>

<p>[caption id=”attachment_179” align=”aligncenter” width=”520”]<img src="http://raycoarana.com/wp-content/uploads/2014/03/ok-glass-e1393787954995.png" alt="Pantalla inicial de Google Glass" /> Pantalla inicial de Google Glass[/caption]</p>

<p>La tarjeta principal, aquella que muestra la hora y el texto “ok glass” es la que nos permite lanzar aplicaciones. Y aquí es donde nos encontramos una de las principales diferencias entre una aplicación Android <em>normal</em> y una aplicación para Google Glass. El inicio de una aplicación no se marca con <strong>android.intent.action.MAIN</strong>, sino que nuestra aplicación debe responder a la intención <strong>com.google.android.glass.action.VOICE_TRIGGER</strong>. Además de esta intención, debemos indicar en forma de meta-datos, una frase. Esta será la frase que el usuario diga tras decir “ok glass” y que hará que se abra nuestra aplicación. En principio esta frase es la que nosotros queramos, tenemos una guía a seguir con una serie de <a href="https://developers.google.com/glass/distribute/voice-checklist">reglas en la estructura y forma</a> de la misma. Pero si pretendemos que Google nos publique la aplicación en MyGlass, debemos ceñirnos al uso de <a href="https://developers.google.com/glass/develop/gdk/input/voice#existing_voice_commands">una lista de frases</a>. Si queremos utilizar otra frase, debemos antes enviarla para su aprobación. Si más de una aplicación está <em>suscrita</em> a una misma frase, el Timeline le dará la opción al usuario de elegir cual de ellas quiere lanzar, de forma similar a como ocurre  actualmente en las aplicaciones para Smartphones y Tablets cuando dos aplicaciones responden a una misma intención.</p>

<p>Para el manejo del Timeline y poder crear y agregar nuestras propias tarjetas, será necesario utilizar una API que está fuera del SDK normal de Android, el llamado GDK (Glass Development Kit). Esto es una librería <strong>jar</strong> con un stub de clases necesarias para poder compilar nuestro proyecto. En ella se incluye esta API para el manejo del Timeline, así como algunas otras clases de ayuda y controles para manejar y crear interfaces apropiadas para el dispositivo. Ya exploraremos estas clases con más detenimiento en próximos artículos.</p>

<p>[sh_margin margin=”20”]</p>

<h3 id="continuará">Continuará…</h3>

<p>En el próximo artículo crearemos nuestra primera aplicación para Google Glass. Exploraremos los pequeños ajustes que debemos hacer en un proyecto Android por defecto para hacerlo compatible y cómo incorporar el GDK.</p>
 <a class="read-more" href="/blog/2014/03/primeros-pasos-con-google-glass/">&raquo;</a>
        </section>
        <footer class="post-meta">
            <img class="author-thumb" src="/assets/images/avatar.jpg" alt="Author image" nopin="nopin" />
            <!-- author -->
            <a href='/author/raycoarana'>Rayco Araña</a>
            <!-- [[tags prefix=" on "]] -->
             
                on 
                
                    
                       <a href='/tag/android'>Android</a>,
                       
                
                    
                       <a href='/tag/gdk'>Gdk</a>,
                       
                
                    
                       <a href='/tag/glassware'>Glassware</a>,
                       
                
                    
                       <a href='/tag/google glass'>Google glass</a>,
                       
                
                    
                       <a href='/tag/timeline'>Timeline</a>
                       
                
            
            <time class="post-date" datetime="2014-03-02">02 Mar 2014</time>
        </footer>
    </article>
    

    <!-- Previous/next page links - displayed on every page -->
    
        <nav class="pagination" role="pagination">
    
        
            <a class="newer-posts" href="/page2/" title="Previous Page">&laquo; Newer Posts</a>
      
    
    <span class="page-number"> Page 3 of 4 </span>
     
        <a class="older-posts" href="/page4/" title="Next Page">Older Posts &raquo;</a>
     
</nav>
    


</main>


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">raycoarana</a> &copy; 2018</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-48361320-1', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
